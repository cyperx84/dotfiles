# GitHub Issue Draft: Add `getBufferContent` MCP Tool

## Title
feat: Add `getBufferContent` tool for reading buffer contents via MCP

## Labels
`enhancement`, `mcp`, `tools`

---

## Issue Body

### Problem

Currently, Claude Code can list open buffers via `getOpenEditors` and read selections via `getCurrentSelection`/`getLatestSelection`, but **cannot read the full content of an open buffer**.

This is problematic because:

1. **Virtual buffers** (like `[CodeCompanion]`, `[scratch]`, or plugin-generated buffers) have no file path and cannot be read via Claude Code's `Read` tool
2. **Unsaved changes** in a buffer are not visible to Claude Code - it can only read the on-disk version
3. **Line-specific context** often requires reading nearby code that isn't selected

### Use Cases

- Reading contents of AI chat buffers (CodeCompanion, Copilot Chat, etc.)
- Accessing unsaved modifications in a buffer
- Getting context around the current cursor position
- Reading scratch buffers or temporary buffers created by plugins
- Inspecting buffer contents without requiring the user to save first

### Proposed Solution

Add a new MCP tool `getBufferContent` that:

1. Reads the full content of any open buffer
2. Supports lookup by:
   - Buffer number (`bufnr`)
   - File path (`filePath`) - with fuzzy matching for partial paths
   - Default to current buffer if neither provided
3. Supports optional line range filtering (`startLine`, `endLine`)
4. Returns rich metadata alongside content

### API Design

```typescript
interface GetBufferContentInput {
  filePath?: string;   // File path (supports partial match)
  bufnr?: number;      // Buffer number (takes precedence)
  startLine?: number;  // Start line, 0-indexed (default: 0)
  endLine?: number;    // End line, 0-indexed exclusive (default: -1 = EOF)
}

interface GetBufferContentOutput {
  bufnr: number;
  filePath: string;
  fileName: string;
  filetype: string;
  content: string;
  lineCount: number;
  totalLines: number;
  isModified: boolean;
  startLine: number;
  endLine: number;
}
```

### Implementation

I have a working implementation ready to submit as a PR. The implementation:

- Follows the existing tool patterns in `lua/claudecode/tools/`
- Handles edge cases (invalid bufnr, unloaded buffers, missing paths)
- Uses `pcall` for safe API calls
- Returns proper MCP-compliant error responses

### Example Usage

```lua
-- Read current buffer
getBufferContent({})

-- Read specific buffer by path
getBufferContent({ filePath = "init.lua" })

-- Read first 50 lines of a buffer
getBufferContent({ filePath = "README.md", startLine = 0, endLine = 50 })

-- Read buffer by number (e.g., for virtual buffers)
getBufferContent({ bufnr = 5 })
```

### Alternatives Considered

1. **External MCP servers** (mcp-neovim-server, nvim-mcp-server): These require socket configuration and add external dependencies. Since claudecode.nvim already has the WebSocket MCP connection, adding the tool natively is cleaner.

2. **Extending `getOpenEditors`**: Could add content to each editor in the list, but this would make the response very large and doesn't support line ranges.

3. **Using `getCurrentSelection`**: Only works for selected text, not full buffer content.

### Checklist

- [x] Follows existing code patterns
- [x] Includes proper error handling
- [x] Has MCP-compliant schema
- [x] Tested locally
- [ ] Ready for PR submission

---

## Related

- Complements existing tools: `getOpenEditors`, `getCurrentSelection`, `getLatestSelection`
- Similar to VS Code extension's ability to read document content
- Enables feature parity with browser-based Claude that can read page content
